## Problema

41 - Cria uma classe chamada `HighScoreManager`, que contém internamente uma
coleção com um máximo de 10 `Tuple<string, float>`, cada um representando o
nome de um jogador e o respetivo _score_. Além da coleção referida, a classe
deve ainda conter:

* Um construtor, que aceita opcionalmente um nome de ficheiro (deve existir
  um nome por omissão), e:
  * Caso o ficheiro não exista, inicializa a coleção sem elementos.
  * Caso o ficheiro exista, abre-o e inicializa a coleção de modo a que
    contenha os nomes e _scores_ especificados no ficheiro.
  * Caso o ficheiro exista, mas tenha um formato inválido, lançar uma excepção
    do tipo `InvalidOperationException`.
* Um método `AddScore(string name, float score)`, que adiciona um novo
  `Tuple<string, float>` à coleção. Se o número de _scores_ ultrapassar 10, o
  tuplo contendo o menor _score_ deve ser removido.
* Um método `Save()`, que guarda os _scores_ no ficheiro especificado no
  construtor.
* Um método `ToString()`, que devolve uma _string_ contendo uma tabela
  devidamente formatada com todos os nomes e _scores_, do mais alto ao mais
  baixo.
* Um método iterável `GetScores()` que retorna de forma ordenada (do _score_
  mais alto até ao _score_ mais baixo) todos tuplos guardados na coleção.

O formato do ficheiro de _high scores_ fica ao critério dos alunos.

Cria também uma classe `Program` com um método `Main` para testar os vários
métodos da classe `HighScoreManager`.

## Soluções

### Solução 1

Classe `HighScoreManager`.

```csharp
using System;
using System.IO;
using System.Text;
using System.Collections.Generic;

namespace Ex_41
{
    public class HighscoreManager
    {
        // Coleção onde escrever os valores lidos
        private List<Tuple<string, float>> _scores;
        private string _file;

        // Comparador usado para os scores
        private CompareTuples _comparer;

        public HighscoreManager(string file = "Scores.txt")
        {
            _file = file;
            _comparer = new CompareTuples();
            _scores = new List<Tuple<string, float>>(10);

            // Verificar se o ficheiro existe
            if (!File.Exists(_file))
            {
                Console.WriteLine("file doesn't exist, " +
                    "initializing Scores without elements");
            }
            else if (Path.GetExtension(_file) != ".txt")
            {
                throw new InvalidOperationException();
            }
            else
            {
                ReadFile();
            }
        }

        // Lê a file especificada no construtor
        private void ReadFile()
        {
            // Bloco try/catch quando se está a aceder o ficheiro
            try
            {
                // Instanciar um `StreamReader` para escrever na file
                using (StreamReader sr = new StreamReader(_file))
                {
                    // String para uso temporário da linha a ser lida
                    string line;

                    while ((line = sr.ReadLine()) != null)
                    {
                        string[] score;
                        // Retirar o nome e o valor em string da linha lida
                        score = line.Split(' ');

                        // Adicionar Score
                        AddScore(score[0], Convert.ToSingle(score[1]));
                    }
                }
            }
            catch (Exception e)
            {
                Console.WriteLine("Couldn't read from file, something went wrong");
                Console.WriteLine(e.Message);
            }
        }

        // Grava o leaderboard na file especificada no construtor
        public void Save()
        {
            // Bloco try/catch quando se está a aceder o ficheiro
            try
            {
                // Instanciar um `StreamWriter` para escrever na file
                using (StreamWriter sw = new StreamWriter(_file))
                {
                    // Escrever todos os scores da instância
                    for (int i = 0; i < _scores.Count; i++)
                    {
                        sw.WriteLine(ScoreLine(_scores[i]));
                    }
                }
            }
            catch (Exception e)
            {
                Console.WriteLine("Couldn't save file, something went wrong");
                Console.WriteLine(e.Message);
            }
        }

        // Adiciona um Score através do nome e do valor
        public void AddScore(string name, float score)
        {
            Tuple<string, float> newScore;
            newScore = new Tuple<string, float>(name, score);

            _scores.Sort(_comparer);
            if (_scores.Count < 10)
            {
                _scores.Add(newScore);
            }
            else if (_scores[9].Item2 < score)
            {
                _scores.RemoveAt(9);
                _scores.Add(newScore);
            }
        }

        public IEnumerable<Tuple<string, float>> GetScores()
        {
            // Organizar o array
            _scores.Sort(_comparer);

            // Retornar cada elemento do array
            foreach (Tuple<string, float> t in _scores)
            {
                yield return t;
            }
        }


        // Função intermédia para a string de um score
        private string ScoreLine(Tuple<string, float> score)
        {
            return score.Item1 + ' ' + score.Item2.ToString();
        }

        public override string ToString()
        {
            // String builder para construir a tabela
            StringBuilder sb;

            // Organizar o array
            _scores.Sort(_comparer);

            sb = new StringBuilder("\tLEADERBOARDS \n \n");
            sb.Append("   Name: \t   Score: \n");

            for (int i = 0; i < _scores.Count; i++)
            {
                sb.AppendLine($"{_scores[i].Item1,8} "
                    + "".PadRight(9, '-')
                    + $" {_scores[i].Item2}");
            }

            return sb.ToString();
        }
    }
}
```

Classe `CompareTuples`

```csharp
using System;
using System.Collections.Generic;

namespace Ex_41
{
    public class CompareTuples : IComparer<Tuple<string, float>>
    {
        public int Compare(Tuple<string, float> score1, Tuple<string, float> score2)
        {
            if (score1 == null) return 1;
            if (score2 == null) return -1;

            return Comparer<float>.Default.Compare(score2.Item2, score1.Item2);
        }
    }
}
```

Classe `Program` para testes.

```csharp
using System;

namespace Ex_41
{
    class Program
    {
        static void Main(string[] args)
        {
            HighscoreManager hsMng, hsMng2;
            hsMng = new HighscoreManager("Leaderboard.txt");
            hsMng2 = new HighscoreManager();

            hsMng.AddScore("Joao", 2);
            hsMng.AddScore("Catarina", 10230.04f);
            hsMng.AddScore("Raquel", 2.5f);
            hsMng.AddScore("Batman", 10230.05f);
            hsMng.AddScore("Anakin", 233);
            hsMng.AddScore("Vader", 124.06f);
            hsMng.AddScore("Vader", 394.06f);
            hsMng.AddScore("SkyW4lkr", 200.4f);
            hsMng.AddScore("Joker", 509.06f);
            hsMng.AddScore("Kojer", 4000.06f);
            hsMng.AddScore("Superman", 745.06f);
            hsMng.AddScore("Potter", 100.5f);

            hsMng2.AddScore("Rita", 22.65f);
            hsMng2.AddScore("Henrique", 22.653f);
            hsMng2.AddScore("Batman", 100.6f);
            hsMng2.AddScore("Harry", 150);

            hsMng2.Save();
            hsMng.Save();
            Console.WriteLine(hsMng);
            Console.WriteLine(hsMng2);

            foreach (Tuple<string, float> t in hsMng.GetScores())
            {
                Console.WriteLine(t);
            }

            Console.WriteLine();
            foreach (Tuple<string, float> t in hsMng2.GetScores())
            {
                Console.WriteLine(t);
            }
        }
    }
}
```

### Solução 2

Classe HighScoreManager:

```csharp
using System;
using System.Collections.Generic;
using System.IO;

namespace ScoreManager
{
    class HighScoreManager
    {
        // Lista dos scores
        private List<Tuple<string, float>> scorelist =
            new List<Tuple<string, float>>(); 
        //
        // Nome do jogador
        private string getname { get; set; }
        //
        // Score do jogador
        private float getscore { get; set; }
        //
        // Caminho para o local do ficheiro
        private string path = "C:/Users/Francisco/Documents/GitHub/ScoreManager/score.txt";
        //

        // Construtor
        public HighScoreManager() {
            Console.WriteLine("Construir");
            // Verificar se existe o ficheiro
            if(File.Exists(path)) {
                // Ler o ficheiro
                Read();
                //
            } 
            else {
                Console.WriteLine("Não existe");
            }
            //
        }
        //

        // Método para ler o ficheiro
        private void Read() {
            Console.WriteLine("Ler ficheiro");
            // Array para expor o score
            string[] lines = System.IO.File.ReadAllLines(path);
            //
            // Mostrar no ecrã o score
            foreach(string line in lines) {
                Console.WriteLine(line);
            }
            //
        }
        //

        // Adicionar valores à lista do score
        public void AddScore(string name, float score) {
            getname = name;
            getscore = score;
            scorelist.Add(new Tuple<string, float>(name, score));
        }
        //

        // Guardar o score num ficheiro txt
        public void Save() {
            System.IO.File.WriteAllText(path,
                "Score:" + Environment.NewLine + ToString());
        }
        //

        // Converter o score para string
        public override string ToString() {
            string result = string.Join(Environment.NewLine, scorelist);
            return result;
        }
        //

        // Ordenar o score e remover os que estão a mais
        public void GetScores() {
            // Ordenar o score
            scorelist.Sort((getname, getscore) =>
            getscore.Item2.CompareTo(getname.Item2));
            //

            // Remover os que estão a mais
            while(scorelist.Count > 10) { 
                Console.WriteLine($"Remover {scorelist[scorelist.Count -1]}");
                scorelist.RemoveAt(scorelist.Count -1);
            }
            //

        }
        //
    }
}
```

Classe Program:

```csharp
using System;

namespace ScoreManager
{
    class Program
    {
        // Aceder à classe HighScoreManager
        private static HighScoreManager _highscoremanager;
        //

        private static void Main(string[] args) {
            // Chamar construtor
            _highscoremanager = new HighScoreManager(); 
            //
            // Input do user
            string userinput;
            //
            // Nome
            string inputname;
            //
            // Score
            float inputscore;
            //
            // Número de resultados que o user vai colocar
            int index = 0;
            //
            Console.WriteLine("Quantos resultados quer meter?: ");
            // Input do user
            userinput = Console.ReadLine();
            //
            // Converter o input para int
            index = Convert.ToInt32(userinput);
            //

            for (int i = 0; i < index; i++) {
                Console.WriteLine("Coloque o nome: ");
                // Input do user
                userinput = Console.ReadLine();
                //
                // Colocar o input na variável do nome
                inputname = userinput;
                //
                Console.WriteLine("Coloque o score: ");
                // Input do user
                userinput = Console.ReadLine();
                //
                // Converter o input para float e colocar na variável do score
                inputscore = float.Parse(userinput);
                //
                // Adicionar o score
                _highscoremanager.AddScore(inputname, inputscore);
                //
            }

            // Chamar o método GetScores para ordenar os scores
            _highscoremanager.GetScores();
            //
            Console.WriteLine("Score: ");
            // Mostrar no ecrã os scores
            Console.WriteLine(_highscoremanager.ToString());
            //
            // Guardar os scores num ficheiro
            _highscoremanager.Save();
            //
        }
    }
}
```

*Por [Francisco Pires](https://github.com/FRP7)*